---
import BaseLayout from "./BaseLayout.astro"

interface Props {
  frontmatter: {
    title: string
    description: string
  }
}

const { frontmatter } = Astro.props

// HeroLayout requires explicit title and description - fail the build if missing
if (!frontmatter?.title) {
  throw new Error(
    "HeroLayout requires a title in frontmatter. If you don't have meaningful title content, consider using a different layout."
  )
}

if (!frontmatter?.description) {
  throw new Error(
    "HeroLayout requires a description in frontmatter. If you don't have meaningful description content, consider using a different layout."
  )
}

const displayTitle = frontmatter.title
const displayDescription = frontmatter.description
---

<BaseLayout frontmatter={frontmatter}>
  <header>
    <h1>{displayTitle}</h1>
    <p>{displayDescription}</p>
    <slot name="hero-content" />
  </header>
  <slot />
</BaseLayout>

<script>
  // Handle navigation shadow removal when hero is present
  const navigationHeader = document.querySelector(
    "body > header"
  ) as HTMLElement

  if (navigationHeader) {
    // Set initial state - no shadow when hero layout is used
    navigationHeader.style.boxShadow = "none"

    // Listen for natural-sticky state changes
    navigationHeader.addEventListener("natural-sticky", (event) => {
      const customEvent = event as CustomEvent
      const currentState = customEvent.detail.state // 'home', 'sticky', or 'relative'

      // Directly control box-shadow based on state
      if (currentState === "home") {
        navigationHeader.style.boxShadow = "none"
      } else {
        navigationHeader.style.boxShadow = "var(--elevation-2)"
      }
    })
  }
</script>

<style is:global>
  /* Hero header - semantic and classless */
  main > header:first-child {
    background-color: var(--color-surface-container-low);
    min-height: 70vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;

    /* Add shadow to create seamless extension of navigation */
    box-shadow: var(--elevation-2);

    /* Ensure shadow appears above subsequent content */
    position: relative;
    z-index: 1;

    /* Limit the content width inside the hero to 42rem */
    padding: 0 max(1rem, (100% - 42rem) / 2);
  }

  main > header h1 {
    /* font-family: var(--font-serif);
    font-size: 5rem;
    font-weight: 100; */
  }

  main > header p {
    font-family: var(--font-serif);
    font-size: 1.6rem;
    font-weight: 380;
  }

  /* Style content in hero-content slot */
  main > header img {
    border-radius: 50%;
    margin: 1rem auto;
    box-shadow: var(--elevation-1);
  }
</style>
