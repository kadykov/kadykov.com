---
import BaseLayout from "./BaseLayout.astro"
import OptimizedImage from "../components/OptimizedImage.astro"

const { frontmatter } = Astro.props
const { title, pubDate, lastUpdatedDate, image, tags } = frontmatter

// Format dates
const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  }).format(new Date(date))
}
---

<BaseLayout frontmatter={frontmatter}>
  <article>
    <header style="margin-bottom: 2rem;">
      <h1 style="margin-bottom: 0.5rem;">{title}</h1>

      <div
        style="font-family: var(--font-sans); color: var(--color-on-surface-variant); font-size: 1rem; margin-bottom: 1rem;"
      >
        <time datetime={pubDate.toISOString()}>
          Published: {formatDate(pubDate)}
        </time>
        {
          lastUpdatedDate && (
            <span style="display: block; margin-top: 0.25rem;">
              <time datetime={lastUpdatedDate.toISOString()}>
                Updated: {formatDate(lastUpdatedDate)}
              </time>
            </span>
          )
        }
      </div>

      {
        tags && tags.length > 0 && (
          <div style="margin-bottom: 1.5rem;">
            <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-wrap: wrap; gap: 0.5rem;">
              {tags.map((tag: string) => (
                <li>
                  <a
                    href={`/tags/${tag}`}
                    style="
                    font-family: var(--font-sans);
                    font-size: 0.875rem;
                    color: var(--color-accent);
                    text-decoration: none;
                    background: var(--color-surface-container-low);
                    padding: 0.25rem 0.5rem;
                    border-radius: 0.25rem;
                    border: 1px solid var(--color-accent);
                    transition: all 0.2s ease;
                  "
                    onmouseover="this.style.background='var(--color-accent)'; this.style.color='var(--color-surface)'"
                    onmouseout="this.style.background='var(--color-surface-container-low)'; this.style.color='var(--color-accent)'"
                  >
                    #{tag}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        )
      }

      {
        image && (
          <figure style="margin: 2rem 0;">
            <OptimizedImage
              src={image.url}
              alt={image.alt}
              displayWidth={800}
              sizesAttr="(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 800px"
              class="blog-post-image"
              loading="eager"
            />
            {image.alt && (
              <figcaption
                style="
              font-family: var(--font-sans);
              font-size: 0.875rem;
              color: var(--color-on-surface-variant);
              text-align: center;
              margin-top: 0.5rem;
              font-style: italic;
            "
              >
                {image.alt}
              </figcaption>
            )}
          </figure>
        )
      }
    </header>
    <slot />
  </article>
</BaseLayout>

<style>
  .blog-post-image {
    width: 100%;
    height: auto;
    border-radius: 0.5rem;
    box-shadow: var(--elevation-1);
  }

  .blog-post-img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Ensure content flows properly */
  article {
    padding: 2rem 0;
  }

  /* Responsive adjustments */
  @media (width <= 768px) {
    article {
      padding: 1rem 0;
    }

    header {
      margin-bottom: 1.5rem !important;
    }

    figure {
      margin: 1.5rem 0 !important;
    }
  }
</style>
