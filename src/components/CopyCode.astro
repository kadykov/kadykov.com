---
// Copy code button functionality for blog posts
---

<svg
  xmlns="http://www.w3.org/2000/svg"
  style="display: none;"
  aria-hidden="true"
>
  <symbol id="icon-copy" viewBox="0 0 24 24">
    <path
      d="M7 6V4q0-2 2-2h10q2 0 2 2v12q0 2-2 2h-2v2q0 2-2 2H5q-2 0-2-2V8q0-2 2-2ZM5 8v12h10V8Zm4-2h8v10h2V4H9Z"
    ></path>
  </symbol>
  <symbol id="icon-check" viewBox="0 0 24 24">
    <path d="M10 16 21 5l1 2-12 12-7-7 1-2Z"></path>
  </symbol>
</svg>

<script>
  document.addEventListener("click", async (event) => {
    const target = event.target
    if (!(target instanceof Element)) return
    const button = target.closest("pre button")
    if (!(button instanceof HTMLButtonElement)) return
    const pre = button.closest("pre")
    const code = pre?.querySelector("code")
    if (!code) return
    try {
      await navigator.clipboard.writeText(code.textContent ?? "")
      const use = button.querySelector("use")
      if (use) use.setAttribute("href", "#icon-check")
      button.classList.add("copied")
      setTimeout(() => {
        if (use) use.setAttribute("href", "#icon-copy")
        button.classList.remove("copied")
      }, 2000)
    } catch (err) {
      console.error("Failed to copy code:", err)
    }
  })
</script>
