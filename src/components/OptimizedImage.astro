---
// src/components/OptimizedImage.astro
// Wrapper component for optimized images using centralized utility.
// This ensures cache sharing with PhotoGallery and all other image components.
import { generateOptimizedImage } from "../utils/imageOptimization"

interface Props {
  src: string
  alt: string
  width?: number // Optional: maximum width constraint
  widths?: number[] // Optional: specific widths for srcset
  sizesAttr?: string // Optional: custom sizes attribute (from getImageDimensions)
  class?: string
  loading?: "lazy" | "eager"
  decoding?: "async" | "sync" | "auto"
  quality?: number
}

const {
  src,
  alt,
  width: maxWidth,
  widths,
  sizesAttr,
  class: className,
  loading = "lazy",
  decoding = "async",
  quality,
} = Astro.props

// Use centralized image optimization utility
// This ensures we generate the same images as PhotoGallery
const optimized = await generateOptimizedImage({
  src,
  maxWidth,
  widths,
  quality,
})
---

<img
  src={optimized.src}
  srcset={optimized.srcset}
  sizes={sizesAttr}
  width={optimized.width}
  height={optimized.height}
  alt={alt}
  loading={loading}
  decoding={decoding}
  class={className}
/>
