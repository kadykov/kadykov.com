---
// src/components/OptimizedImage.astro
// Wrapper component for optimized images using centralized utility.
// This ensures cache sharing with PhotoGallery and all other image components.
import { generateOptimizedImage } from "../utils/imageOptimization"

interface Props {
  src: string
  alt: string
  width?: number // Optional: maximum width constraint OR original image width
  height?: number // Optional: original image height (required if providing original width to skip remote fetch)
  sizesAttr?: string // Optional: custom sizes attribute (from getImageDimensions)
  class?: string
  loading?: "lazy" | "eager"
  decoding?: "async" | "sync" | "auto"
  quality?: number
  originalWidth?: number // Optional: explicit original width (if width is maxWidth)
  originalHeight?: number // Optional: explicit original height (if height is maxHeight)
}

const {
  src,
  alt,
  width: maxWidth,
  height: maxHeight,
  originalWidth,
  originalHeight,
  sizesAttr,
  class: className,
  loading = "lazy",
  decoding = "async",
  quality,
} = Astro.props

// Use centralized image optimization utility
// This ensures we generate the same images as PhotoGallery
const optimized = await generateOptimizedImage({
  src,
  maxWidth,
  width: originalWidth,
  height: originalHeight,
  quality,
})
---

<img
  src={optimized.src}
  srcset={optimized.srcset}
  sizes={sizesAttr}
  width={optimized.width}
  height={optimized.height}
  alt={alt}
  loading={loading}
  decoding={decoding}
  class={className}
/>
