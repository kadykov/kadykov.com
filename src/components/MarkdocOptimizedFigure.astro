---
import OptimizedImage from "./OptimizedImage.astro"

interface Props {
  src: string
  alt: string
  title?: string
  width?: number
  height?: number
  displayWidth?: number
  sizesAttr?: string
  caption?: string
  optimized?: boolean // Whether to use OptimizedImage
}

const {
  src,
  alt,
  title,
  width,
  height,
  displayWidth = 800,
  sizesAttr = "(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 800px",
  caption,
  optimized = false,
} = Astro.props

// Check if it's a remote URL
const isRemoteUrl =
  src.startsWith("http://") ||
  src.startsWith("https://") ||
  src.startsWith("//")
---

<figure class="my-6">
  {
    optimized && !isRemoteUrl && width && height ? (
      <OptimizedImage
        src={src}
        alt={alt}
        width={width}
        height={height}
        displayWidth={displayWidth}
        sizesAttr={sizesAttr}
        class="rounded-lg shadow-sm"
        loading="lazy"
        decoding="async"
      />
    ) : (
      <img
        src={src}
        alt={alt}
        title={title}
        width={width}
        height={height}
        loading="lazy"
        decoding="async"
        class="block w-full h-auto rounded-lg shadow-sm max-w-full"
      />
    )
  }
  {
    caption && (
      <figcaption class="mt-2 text-sm text-gray-600 dark:text-gray-400 text-center italic">
        {caption}
      </figcaption>
    )
  }
</figure>
