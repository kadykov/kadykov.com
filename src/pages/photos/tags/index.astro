---
import BaseLayout from "../../../layouts/BaseLayout.astro"
import type { PhotoManifestItem } from "../../../utils/photoManifestSchema"
import { getCollection } from "astro:content"
import Hero from "../../../components/Hero.astro"

let uniqueTags: string[] = []

// Fetch all photos from the collection (cached by Astro)
const photoEntries = await getCollection("photos")
const allPhotos: PhotoManifestItem[] = photoEntries.map(
  (entry) => entry.data as PhotoManifestItem
)

const tagSet = new Set<string>()
allPhotos.forEach((photo) => {
  if (photo.tags && photo.tags.length > 0) {
    photo.tags.forEach((tag) => tagSet.add(tag.toLowerCase()))
  }
})
uniqueTags = Array.from(tagSet).sort((a, b) => a.localeCompare(b))

const frontmatter = {
  title: "Photo tags",
  description: "Browse photos by tags.",
}
---

<BaseLayout frontmatter={frontmatter}>
  <Hero>
    <h1>{frontmatter.title}</h1>
    <p>Explore photos by tags</p>
  </Hero>

  {
    uniqueTags.length > 0 ? (
      <nav aria-label="Photo tags">
        <ul>
          {uniqueTags.map((tag) => (
            <li>
              <a href={`/photos/tags/${encodeURIComponent(tag)}/1`}>#{tag}</a>
            </li>
          ))}
        </ul>
      </nav>
    ) : (
      <p>No photo tags found.</p>
    )
  }

  <nav>
    <ul>
      <li><a href="/photos/1">All photos</a></li>
      <li><a href="/photos/dates">Browse by date</a></li>
    </ul>
  </nav>
</BaseLayout>
