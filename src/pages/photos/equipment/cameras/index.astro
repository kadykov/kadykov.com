---
import BaseLayout from "../../../../layouts/BaseLayout.astro"
import type { PhotoManifestItem } from "../../../../utils/photoManifestSchema"
import { getCollection } from "astro:content"
import Hero from "../../../../components/Hero.astro"

let uniqueCameras: string[] = []
let cameraCounts: Map<string, number> = new Map()

// Fetch all photos from the collection (cached by Astro)
const photoEntries = await getCollection("photos")
const allPhotos: PhotoManifestItem[] = photoEntries.map(
  (entry) => entry.data as PhotoManifestItem
)

const cameraSet = new Set<string>()
allPhotos.forEach((photo) => {
  if (photo.cameraModel) {
    cameraSet.add(photo.cameraModel)
    cameraCounts.set(
      photo.cameraModel,
      (cameraCounts.get(photo.cameraModel) || 0) + 1
    )
  }
})
uniqueCameras = Array.from(cameraSet).sort((a, b) => a.localeCompare(b))

const frontmatter = {
  title: "Browse by Camera",
  description: "Explore photos grouped by camera model.",
}
---

<BaseLayout frontmatter={frontmatter}>
  <Hero>
    <h1>{frontmatter.title}</h1>
    <p>{frontmatter.description}</p>
  </Hero>

  {
    uniqueCameras.length > 0 ? (
      <nav aria-label="Camera models">
        <ul>
          {uniqueCameras.map((camera) => (
            <li>
              <a href={`/photos/equipment/cameras/${camera}/1`}>
                {camera} ({cameraCounts.get(camera)} photos)
              </a>
            </li>
          ))}
        </ul>
      </nav>
    ) : (
      <p>No camera information found.</p>
    )
  }

  <nav>
    <ul>
      <li><a href="/photos/equipment">‚Üê Back to equipment</a></li>
    </ul>
  </nav>
</BaseLayout>
