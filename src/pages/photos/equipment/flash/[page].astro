---
import PhotoIndexPageLayout from "../../../../layouts/PhotoIndexPageLayout.astro"
import Hero from "../../../../components/Hero.astro"
import type { PhotoManifestItem } from "../../../../utils/photoManifestSchema"
import { getCollection } from "astro:content"
import type { Page, PaginateFunction } from "astro"

export async function getStaticPaths({
  paginate,
}: {
  paginate: PaginateFunction
}) {
  const PAGE_SIZE = 24

  const photoEntries = await getCollection("photos")
  const fetchedPhotos: PhotoManifestItem[] = photoEntries.map(
    (entry) => entry.data as PhotoManifestItem
  )

  // Filter photos where flash was used
  const flashPhotos = fetchedPhotos.filter((photo) => photo.flash === true)

  // Sort by date, most recent first
  flashPhotos.sort((a, b) => {
    if (a.dateTaken && b.dateTaken) {
      return new Date(b.dateTaken).getTime() - new Date(a.dateTaken).getTime()
    }
    if (a.dateTaken) return -1
    if (b.dateTaken) return 1
    return 0
  })

  return paginate(flashPhotos, {
    pageSize: PAGE_SIZE,
    props: { fullPhotoDataset: flashPhotos },
  })
}

interface Props {
  page: Page<PhotoManifestItem>
  fullPhotoDataset: PhotoManifestItem[]
}

const { page, fullPhotoDataset } = Astro.props

const pageTitle = "Photos Taken with Flash"
const pageDescription = `A collection of photos taken with flash. Page ${page.currentPage} of ${page.lastPage}.`
---

<PhotoIndexPageLayout
  page={page}
  fullPhotoDataset={fullPhotoDataset}
  pageTitle={pageTitle}
  pageDescription={pageDescription}
  currentNav="equipment"
>
  <Hero slot="heroContent">
    <h1>{pageTitle}</h1>
    <p>{pageDescription}</p>
  </Hero>
</PhotoIndexPageLayout>
