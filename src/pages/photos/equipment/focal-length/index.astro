---
import BaseLayout from "../../../../layouts/BaseLayout.astro"
import type { PhotoManifestItem } from "../../../../utils/photoManifestSchema"
import { getCollection } from "astro:content"
import Hero from "../../../../components/Hero.astro"
import PhotoNavigation from "../../../../components/PhotoNavigation.astro"
import { countByField, formatCount } from "../../../../utils/collectionHelpers"

// Map of category to display name and description
const categoryInfo = {
  "ultra-wide": {
    name: "Ultra-Wide",
    description: "< 24mm (35mm equivalent)",
  },
  wide: {
    name: "Wide",
    description: "24-34mm (35mm equivalent)",
  },
  normal: {
    name: "Normal",
    description: "35-69mm (35mm equivalent)",
  },
  "short-telephoto": {
    name: "Short Telephoto",
    description: "70-134mm (35mm equivalent)",
  },
  telephoto: {
    name: "Telephoto",
    description: "135-299mm (35mm equivalent)",
  },
  "super-telephoto": {
    name: "Super Telephoto",
    description: "â‰¥ 300mm (35mm equivalent)",
  },
}

// Fetch all photos from the collection (cached by Astro)
const photoEntries = await getCollection("photos")
const allPhotos: PhotoManifestItem[] = photoEntries.map(
  (entry) => entry.data as PhotoManifestItem
)

const categoryCounts = countByField(
  allPhotos,
  (photo) => photo.focalLengthCategory
)

const frontmatter = {
  title: "Browse by Focal Length",
  description: "Explore photos grouped by focal length category.",
}
---

<BaseLayout frontmatter={frontmatter}>
  <Hero>
    <h1>{frontmatter.title}</h1>
    <p>{frontmatter.description}</p>
  </Hero>

  {
    categoryCounts.size > 0 ? (
      <nav aria-label="Focal length categories">
        <ul>
          {Object.entries(categoryInfo).map(([key, info]) => {
            const count = categoryCounts.get(key) || 0
            if (count === 0) return null
            return (
              <li>
                <a
                  href={`/photos/equipment/focal-length/${key}/1`}
                  title={info.description}
                >
                  {info.name} {formatCount(count)}
                </a>
              </li>
            )
          })}
        </ul>
      </nav>
    ) : (
      <p>No focal length information found.</p>
    )
  }

  <PhotoNavigation currentPage="equipment" />
</BaseLayout>
