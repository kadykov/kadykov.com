---
// So far we have not used any Astro layout in this file, so we can keep it simple.
// title: "Interactive OKLCH Color Picker"
// description: "Real-time color system editor for surface, primary, and accent colors"
import "../styles/base.css"
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>OKLCH Color Picker</title>
    <style>
      body {
        background: var(--color-surface);
        color: var(--color-on-surface);
        margin: 0;
        padding: 0;
        transition: all 0.2s ease;
        height: 100vh;
        overflow: hidden;
      }

      .container {
        display: grid;
        grid-template-columns: 350px 1fr;
        height: 100vh;
      }

      .controls {
        background: var(--color-surface-container);
        padding: 1.5rem;
        box-shadow: var(--elevation-2);
        overflow-y: auto;
        border-right: 1px solid var(--color-surface-container-high);
      }

      .control-group {
        margin-bottom: 2rem;
        padding: 1rem;
        background: var(--color-surface-container-low);
        border-radius: 0.5rem;
        transition: border 0.2s ease;
      }

      .control-group.out-of-gamut {
        border: 2px solid #f44;
        background: var(--color-surface-container);
      }

      .control-group h3 {
        margin: 0 0 1rem;
        color: var(--color-on-surface);
        font-size: 1.1rem;
        font-weight: 600;
      }

      .slider-group {
        margin-bottom: 1rem;
      }

      .slider-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        color: var(--color-on-surface-variant);
        font-weight: 500;
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      input[type="range"] {
        flex: 1;
        height: 6px;
        border-radius: 3px;
        background: var(--color-surface-container-highest);
        outline: none;
        appearance: none;
      }

      input[type="range"]::-webkit-slider-thumb {
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--color-primary);
        cursor: pointer;
        border: 2px solid var(--color-surface);
        box-shadow: var(--elevation-1);
      }

      input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--color-primary);
        cursor: pointer;
        border: 2px solid var(--color-surface);
        box-shadow: var(--elevation-1);
      }

      .value-display {
        min-width: 60px;
        text-align: right;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        color: var(--color-on-surface);
        background: var(--color-surface-container-highest);
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
      }

      .color-preview {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 2px solid var(--color-surface-container-highest);
        margin-left: 0.5rem;
        position: relative;
      }

      .gamut-warning {
        color: #f44;
        font-size: 0.75rem;
        margin-top: 0.5rem;
        font-weight: 600;
        display: none;
        align-items: center;
        gap: 0.25rem;
      }

      .gamut-warning.visible {
        display: flex;
      }

      .gamut-warning-icon {
        font-size: 0.9rem;
      }

      .preview-area {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        padding: 1.5rem;
        overflow-y: auto;
        background: var(--color-surface);
      }

      .copy-button {
        width: 100%;
        background: var(--color-accent);
        color: var(--color-on-accent);
        border: none;
        padding: 0.75rem;
        border-radius: 0.5rem;
        cursor: pointer;
        font-weight: 600;
        margin-top: 1rem;
        transition: all 0.2s ease;
      }

      .copy-button:hover {
        background: var(--color-accent);
        filter: brightness(1.1);
        box-shadow: var(--elevation-2);
      }

      .copy-button:active {
        transform: scale(0.98);
      }

      .preview-section {
        background: var(--color-surface-container);
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: var(--elevation-1);
        margin-bottom: 1rem;
      }

      .preview-section h2 {
        margin: 0 0 1rem;
        color: var(--color-on-surface);
      }

      .color-swatches {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }

      .color-swatch {
        padding: 1rem;
        border-radius: 0.5rem;
        text-align: center;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        min-height: 60px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .component-examples {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }

      .example-card {
        background: var(--color-surface);
        padding: 1.5rem;
        border-radius: 0.75rem;
        box-shadow: var(--elevation-1);
      }

      .example-buttons {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 1rem;
      }

      .btn-primary {
        background: var(--color-primary);
        color: var(--color-on-primary);
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        cursor: pointer;
      }

      .btn-secondary {
        background: var(--color-surface-container);
        color: var(--color-on-surface);
        border: 2px solid var(--color-surface-container);
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        cursor: pointer;
      }

      .btn-accent {
        background: var(--color-accent);
        color: var(--color-on-accent);
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        cursor: pointer;
      }

      .code-output {
        background: var(--color-surface-container-lowest);
        padding: 1rem;
        border-radius: 0.5rem;
        font-family: var(--font-mono);
        font-size: 0.85rem;
        margin-top: 1rem;
        white-space: pre-line;
        color: var(--color-on-surface);
      }

      @media (width <= 1024px) {
        .container {
          grid-template-columns: 1fr;
          grid-template-rows: auto 1fr;
        }

        .controls {
          max-height: 40vh;
          border-right: none;
          border-bottom: 1px solid var(--color-surface-container-high);
        }

        .preview-area {
          max-height: 60vh;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="controls">
        <h2>OKLCH Color Controls</h2>

        <!-- Surface Color Controls -->
        <div class="control-group" id="surface-control-group">
          <h3>Surface Color</h3>
          <div class="slider-group">
            <label>Lightness (L)</label>
            <div class="slider-container">
              <input
                type="range"
                id="surface-l"
                min="0.15"
                max="1"
                step="0.01"
                value="0.99"
              />
              <span class="value-display" id="surface-l-value">0.99</span>
              <div class="color-preview" id="surface-preview"></div>
            </div>
          </div>
          <div class="slider-group">
            <label>Chroma (C)</label>
            <div class="slider-container">
              <input
                type="range"
                id="surface-c"
                min="0"
                max="0.3"
                step="0.01"
                value="0.01"
              />
              <span class="value-display" id="surface-c-value">0.01</span>
            </div>
          </div>
          <div class="slider-group">
            <label>Hue (H)</label>
            <div class="slider-container">
              <input
                type="range"
                id="surface-h"
                min="0"
                max="360"
                step="1"
                value="254"
              />
              <span class="value-display" id="surface-h-value">254</span>
            </div>
          </div>
          <div class="gamut-warning" id="surface-gamut-warning">
            <span class="gamut-warning-icon">⚠️</span>
            <span>Out of sRGB gamut - color may not display accurately</span>
          </div>
        </div>

        <!-- Primary Color Controls -->
        <div class="control-group" id="primary-control-group">
          <h3>Primary Color</h3>
          <div class="slider-group">
            <label>Lightness (L)</label>
            <div class="slider-container">
              <input
                type="range"
                id="primary-l"
                min="0.15"
                max="1"
                step="0.01"
                value="0.55"
              />
              <span class="value-display" id="primary-l-value">0.55</span>
              <div class="color-preview" id="primary-preview"></div>
            </div>
          </div>
          <div class="slider-group">
            <label>Chroma (C)</label>
            <div class="slider-container">
              <input
                type="range"
                id="primary-c"
                min="0"
                max="0.3"
                step="0.01"
                value="0.12"
              />
              <span class="value-display" id="primary-c-value">0.12</span>
            </div>
          </div>
          <div class="slider-group">
            <label>Hue (H)</label>
            <div class="slider-container">
              <input
                type="range"
                id="primary-h"
                min="0"
                max="360"
                step="1"
                value="254"
              />
              <span class="value-display" id="primary-h-value">254</span>
            </div>
          </div>
          <div class="gamut-warning" id="primary-gamut-warning">
            <span class="gamut-warning-icon">⚠️</span>
            <span>Out of sRGB gamut - color may not display accurately</span>
          </div>
        </div>

        <!-- Accent Color Controls -->
        <div class="control-group" id="accent-control-group">
          <h3>Accent Color</h3>
          <div class="slider-group">
            <label>Lightness (L)</label>
            <div class="slider-container">
              <input
                type="range"
                id="accent-l"
                min="0.15"
                max="0.98"
                step="0.01"
                value="0.75"
              />
              <span class="value-display" id="accent-l-value">0.75</span>
              <div class="color-preview" id="accent-preview"></div>
            </div>
          </div>
          <div class="slider-group">
            <label>Chroma (C)</label>
            <div class="slider-container">
              <input
                type="range"
                id="accent-c"
                min="0"
                max="0.3"
                step="0.01"
                value="0.18"
              />
              <span class="value-display" id="accent-c-value">0.18</span>
            </div>
          </div>
          <div class="slider-group">
            <label>Hue (H)</label>
            <div class="slider-container">
              <input
                type="range"
                id="accent-h"
                min="0"
                max="360"
                step="1"
                value="44"
              />
              <span class="value-display" id="accent-h-value">44</span>
            </div>
          </div>
          <div class="gamut-warning" id="accent-gamut-warning">
            <span class="gamut-warning-icon">⚠️</span>
            <span>Out of sRGB gamut - color may not display accurately</span>
          </div>
        </div>

        <button class="copy-button" id="copy-button">
          Copy CSS Variables
        </button>
      </div>

      <div class="preview-area">
        <!-- Color Swatches -->
        <div class="preview-section">
          <h2>Color System Preview</h2>
          <div class="color-swatches">
            <div
              class="color-swatch"
              style="background: var(--color-surface); color: var(--color-on-surface);"
            >
              Surface<br />var(--color-surface)
            </div>
            <div
              class="color-swatch"
              style="background: var(--color-surface-container); color: var(--color-on-surface);"
            >
              Surface Container<br />var(--color-surface-container)
            </div>
            <div
              class="color-swatch"
              style="background: var(--color-primary); color: var(--color-on-primary);"
            >
              Primary<br />var(--color-primary)
            </div>
            <div
              class="color-swatch"
              style="background: var(--color-primary-container); color: var(--color-on-primary-container);"
            >
              Primary Container<br />var(--color-primary-container)
            </div>
            <div
              class="color-swatch"
              style="background: var(--color-accent); color: var(--color-on-accent);"
            >
              Accent<br />var(--color-accent)
            </div>
            <div
              class="color-swatch"
              style="background: var(--color-accent-container); color: var(--color-on-accent-container);"
            >
              Accent Container<br />var(--color-accent-container)
            </div>
          </div>
        </div>

        <!-- Component Examples -->
        <div class="preview-section">
          <h2>Component Examples</h2>
          <div class="component-examples">
            <div class="example-card">
              <h3>Buttons</h3>
              <div class="example-buttons">
                <button class="btn-primary">Primary</button>
                <button class="btn-secondary">Secondary</button>
                <button class="btn-accent">Accent</button>
              </div>
            </div>

            <div class="example-card">
              <h3>Links & Navigation</h3>
              <p>
                Here are some <a href="#">regular links</a> within text. You can
                also see <a href="#" style="color: var(--color-primary);"
                  >primary colored links</a
                > and <a href="#" style="color: var(--color-accent);"
                  >accent colored links</a
                >.
              </p>
              <nav style="margin-top: 1rem;">
                <a href="#" style="margin-right: 1rem;">Home</a>
                <a href="#" style="margin-right: 1rem;">About</a>
                <a href="#" style="margin-right: 1rem;">Contact</a>
              </nav>
            </div>

            <div class="example-card">
              <h3>Form Elements</h3>
              <input
                type="text"
                placeholder="Text input"
                style="width: 100%; margin-bottom: 0.5rem;"
              />
              <select style="width: 100%;">
                <option>Select option</option>
              </select>
            </div>

            <div
              class="example-card"
              style="background: var(--color-primary-container); color: var(--color-on-primary-container);"
            >
              <h3>Primary Container</h3>
              <p>This card uses primary container colors.</p>
            </div>

            <div
              class="example-card"
              style="background: var(--color-accent-container); color: var(--color-on-accent-container);"
            >
              <h3>Accent Container</h3>
              <p>This card uses accent container colors.</p>
            </div>
          </div>
        </div>

        <!-- Article Content Examples -->
        <div class="preview-section">
          <h2>Article Content Examples</h2>
          <article style="max-width: none; padding: 0;">
            <h1>Sample Article Title</h1>
            <p>
              This is a sample article paragraph demonstrating how regular body
              text looks with the current color scheme. The text should have
              good contrast and readability.
            </p>

            <h2>Typography Examples</h2>
            <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do
              eiusmod tempor incididunt ut labore et dolore magna aliqua. <strong
                >This text is bold</strong
              > and <em>this text is italic</em>. You can also see <a href="#"
                >links within paragraphs</a
              > that maintain good contrast.
            </p>

            <h3>Lists and Structure</h3>
            <ul>
              <li>First unordered list item</li>
              <li>Second item with <a href="#">a link</a></li>
              <li>Third item</li>
            </ul>

            <ol>
              <li>First ordered list item</li>
              <li>Second ordered item</li>
              <li>Third ordered item</li>
            </ol>

            <h4>Code and Technical Content</h4>
            <p>
              Here's some inline <code>code syntax</code> within a paragraph. You
              can also see keyboard shortcuts like <kbd>Ctrl+C</kbd> and <kbd
                >Cmd+V</kbd
              >.
            </p>

            <pre><code>// Sample code block
function colorPicker() &#123;
  const surface = 'oklch(0.99 0.01 254)';
  const primary = 'oklch(0.55 0.15 254)';
  return &#123; surface, primary &#125;;
&#125;</code></pre>

            <blockquote>
              <p>
                This is a blockquote example. It demonstrates how quoted text
                appears with the current color system. Blockquotes often contain
                important information or citations.
              </p>
              <footer>— Quote Attribution</footer>
            </blockquote>

            <h4>More Text Elements</h4>
            <p>
              Additional text elements include <mark
                style="background: var(--color-accent-container); color: var(--color-on-accent-container); padding: 0.1em 0.2em;"
                >highlighted text</mark
              >, <small>small text</small>, and <del>deleted text</del>.
            </p>

            <hr
              style="border: none; border-top: 1px solid var(--color-surface-container-high); margin: 2rem 0;"
            />

            <p>
              <strong>Conclusion:</strong> This article content demonstrates how
              various text elements work together with the OKLCH color system, ensuring
              good readability and visual hierarchy.
            </p>
          </article>
        </div>

        <!-- CSS Output -->
        <div class="preview-section">
          <h2>Generated CSS Variables</h2>
          <div class="code-output" id="css-output"></div>
        </div>
      </div>
    </div>

    <script is:inline>
      // Wait for DOM to be fully loaded
      document.addEventListener("DOMContentLoaded", function () {
        /*
         * OKLCH to sRGB Gamut Checking Implementation
         *
         * This implementation uses the official OKLCH specification coefficients
         * from the CSS Color Module Level 4 working draft and related standards.
         *
         * Conversion chain: OKLCH → OKLab → XYZ → linear sRGB → gamma-corrected sRGB
         *
         * Gamut checking: Colors are considered out-of-gamut if any RGB component
         * falls outside the [0, 1] range after conversion.
         *
         * The matrices and coefficients are sourced from:
         * - https://bottosson.github.io/posts/oklab/
         * - CSS Color Module Level 4 specification
         * - Official W3C CSSWG working drafts
         */
        function multiplyMatrices(A, B) {
          // Simple matrix multiplication for 3x3 matrix and 3x1 vector
          return [
            A[0][0] * B[0] + A[0][1] * B[1] + A[0][2] * B[2],
            A[1][0] * B[0] + A[1][1] * B[1] + A[1][2] * B[2],
            A[2][0] * B[0] + A[2][1] * B[1] + A[2][2] * B[2],
          ]
        }

        function OKLCH_to_OKLab(OKLCH) {
          return [
            OKLCH[0], // L is still L
            OKLCH[1] * Math.cos((OKLCH[2] * Math.PI) / 180), // a
            OKLCH[1] * Math.sin((OKLCH[2] * Math.PI) / 180), // b
          ]
        }

        function OKLab_to_XYZ(OKLab) {
          // Given OKLab, convert to XYZ relative to D65
          // Using official matrices from the OKLCH specification
          // https://www.w3.org/TR/css-color-4/#color-conversion-code
          // https://bottosson.github.io/posts/oklab/
          var LMStoXYZ = [
            [1.2268798758459243, -0.5578149944602171, 0.2813910456659647],
            [-0.0405757452148008, 1.112286803280317, -0.0717110580655164],
            [-0.0763729366746601, -0.4214933324022432, 1.5869240198367816],
          ]
          var OKLabtoLMS = [
            [1.0, 0.3963377773761749, 0.2158037573099136],
            [1.0, -0.1055613458156586, -0.0638541728258133],
            [1.0, -0.0894841775298119, -1.2914855480194092],
          ]

          var LMSnl = multiplyMatrices(OKLabtoLMS, OKLab)
          return multiplyMatrices(
            LMStoXYZ,
            LMSnl.map((c) => c ** 3)
          )
        }

        function XYZ_to_lin_sRGB(XYZ) {
          // convert XYZ to linear-light sRGB
          // Using official matrix from the specification
          var M = [
            [12831 / 3959, -329 / 214, -1974 / 3959],
            [-851781 / 878810, 1648619 / 878810, 36519 / 878810],
            [705 / 12673, -2585 / 12673, 705 / 667],
          ]

          return multiplyMatrices(M, XYZ)
        }

        function gam_sRGB(RGB) {
          // convert an array of linear-light sRGB values in the range 0.0-1.0
          // to gamma corrected form
          // https://en.wikipedia.org/wiki/SRGB
          // Extended transfer function:
          // For negative values, linear portion extends on reflection
          // of axis, then uses reflected pow below that
          return RGB.map(function (val) {
            let sign = val < 0 ? -1 : 1
            let abs = Math.abs(val)

            if (abs > 0.0031308) {
              return sign * (1.055 * Math.pow(abs, 1 / 2.4) - 0.055)
            }

            return 12.92 * val
          })
        }

        function oklchToRgb(l, c, h) {
          // Convert OKLCH to OKLab
          const oklab = OKLCH_to_OKLab([l, c, h])

          // Convert OKLab to XYZ
          const xyz = OKLab_to_XYZ(oklab)

          // Convert XYZ to linear sRGB
          const rgb_linear = XYZ_to_lin_sRGB(xyz)

          // Apply gamma correction
          const rgb = gam_sRGB(rgb_linear)

          return { r: rgb[0], g: rgb[1], b: rgb[2] }
        }

        function isInSrgbGamut(l, c, h) {
          const rgb = oklchToRgb(l, c, h)
          // Check if all RGB values are within valid range [0, 1]
          // Use a tighter tolerance for more accurate gamut detection
          const tolerance = 0.0001
          return (
            rgb.r >= -tolerance &&
            rgb.r <= 1 + tolerance &&
            rgb.g >= -tolerance &&
            rgb.g <= 1 + tolerance &&
            rgb.b >= -tolerance &&
            rgb.b <= 1 + tolerance
          )
        }

        function findGamutBoundary(l, h, maxChroma = 0.5) {
          // Binary search to find the maximum chroma that stays in gamut
          // This helps users understand what the maximum safe chroma is
          let low = 0
          let high = maxChroma
          let bestChroma = 0

          for (let i = 0; i < 20; i++) {
            // 20 iterations gives us good precision
            const mid = (low + high) / 2
            if (isInSrgbGamut(l, mid, h)) {
              bestChroma = mid
              low = mid
            } else {
              high = mid
            }
          }

          return bestChroma
        }

        function updateGamutWarnings() {
          // Check each color group for gamut violations
          const colorGroups = [
            {
              prefix: "surface",
              l: parseFloat(sliders["surface-l"]?.value || "0.99"),
              c: parseFloat(sliders["surface-c"]?.value || "0.01"),
              h: parseFloat(sliders["surface-h"]?.value || "254"),
            },
            {
              prefix: "primary",
              l: parseFloat(sliders["primary-l"]?.value || "0.55"),
              c: parseFloat(sliders["primary-c"]?.value || "0.12"),
              h: parseFloat(sliders["primary-h"]?.value || "254"),
            },
            {
              prefix: "accent",
              l: parseFloat(sliders["accent-l"]?.value || "0.75"),
              c: parseFloat(sliders["accent-c"]?.value || "0.18"),
              h: parseFloat(sliders["accent-h"]?.value || "44"),
            },
          ]

          colorGroups.forEach((group) => {
            const isInGamut = isInSrgbGamut(group.l, group.c, group.h)
            const controlGroup = document.getElementById(
              `${group.prefix}-control-group`
            )
            const warning = document.getElementById(
              `${group.prefix}-gamut-warning`
            )

            if (controlGroup && warning) {
              if (isInGamut) {
                controlGroup.classList.remove("out-of-gamut")
                warning.classList.remove("visible")
              } else {
                controlGroup.classList.add("out-of-gamut")
                warning.classList.add("visible")

                // Calculate the maximum safe chroma for better user guidance
                const maxSafeChroma = findGamutBoundary(group.l, group.h)
                const warningText = warning.querySelector("span:last-child")
                if (warningText) {
                  warningText.textContent = `Out of sRGB gamut - try chroma ≤ ${maxSafeChroma.toFixed(3)}`
                }
              }
            }
          })
        }

        // Initialize all sliders and their event listeners
        const sliders = {
          "surface-l": document.getElementById("surface-l"),
          "surface-c": document.getElementById("surface-c"),
          "surface-h": document.getElementById("surface-h"),
          "primary-l": document.getElementById("primary-l"),
          "primary-c": document.getElementById("primary-c"),
          "primary-h": document.getElementById("primary-h"),
          "accent-l": document.getElementById("accent-l"),
          "accent-c": document.getElementById("accent-c"),
          "accent-h": document.getElementById("accent-h"),
        }

        // Add event listeners to all sliders
        Object.entries(sliders).forEach(([id, slider]) => {
          if (slider) {
            slider.addEventListener("input", updateColors)
            // Update initial display values
            const valueDisplay = document.getElementById(id + "-value")
            if (valueDisplay) {
              valueDisplay.textContent = slider.value
            }
          }
        })

        // Add copy button event listener
        const copyButton = document.getElementById("copy-button")
        if (copyButton) {
          copyButton.addEventListener("click", copyCSS)
        }

        function updateColors() {
          // Update CSS custom properties
          Object.entries(sliders).forEach(([id, slider]) => {
            if (slider) {
              document.documentElement.style.setProperty(
                "--" + id,
                slider.value
              )
              const valueDisplay = document.getElementById(id + "-value")
              if (valueDisplay) {
                valueDisplay.textContent = slider.value
              }
            }
          })

          // Update color previews
          updateColorPreviews()
          updateCSSOutput()
          updateGamutWarnings()
        }

        function updateColorPreviews() {
          const surfaceL = sliders["surface-l"]?.value || "0.99"
          const surfaceC = sliders["surface-c"]?.value || "0.01"
          const surfaceH = sliders["surface-h"]?.value || "254"
          const primaryL = sliders["primary-l"]?.value || "0.55"
          const primaryC = sliders["primary-c"]?.value || "0.12"
          const primaryH = sliders["primary-h"]?.value || "254"
          const accentL = sliders["accent-l"]?.value || "0.70"
          const accentC = sliders["accent-c"]?.value || "0.18"
          const accentH = sliders["accent-h"]?.value || "44"

          const surfacePreview = document.getElementById("surface-preview")
          const primaryPreview = document.getElementById("primary-preview")
          const accentPreview = document.getElementById("accent-preview")

          if (surfacePreview) {
            surfacePreview.style.background = `oklch(${surfaceL} ${surfaceC} ${surfaceH})`
          }
          if (primaryPreview) {
            primaryPreview.style.background = `oklch(${primaryL} ${primaryC} ${primaryH})`
          }
          if (accentPreview) {
            accentPreview.style.background = `oklch(${accentL} ${accentC} ${accentH})`
          }
        }

        function updateCSSOutput() {
          const css = `/* Theme Colors */
--surface-l: ${sliders["surface-l"]?.value || "0.99"};
--surface-c: ${sliders["surface-c"]?.value || "0.01"};
--surface-h: ${sliders["surface-h"]?.value || "254"};

--primary-l: ${sliders["primary-l"]?.value || "0.55"};
--primary-c: ${sliders["primary-c"]?.value || "0.12"};
--primary-h: ${sliders["primary-h"]?.value || "254"};

--accent-l: ${sliders["accent-l"]?.value || "0.70"};
--accent-c: ${sliders["accent-c"]?.value || "0.18"};
--accent-h: ${sliders["accent-h"]?.value || "44"};`

          const cssOutput = document.getElementById("css-output")
          if (cssOutput) {
            cssOutput.textContent = css
          }
        }

        function copyCSS() {
          const cssOutput = document.getElementById("css-output")
          const cssText = cssOutput?.textContent
          if (cssText) {
            // Use modern Clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
              navigator.clipboard
                .writeText(cssText)
                .then(() => {
                  showCopyFeedback()
                })
                .catch((err) => {
                  console.error("Failed to copy:", err)
                  alert(
                    "Copy failed. Please manually select and copy the CSS code."
                  )
                })
            } else {
              // Browser doesn't support Clipboard API
              alert(
                "Copy not supported in this browser. Please manually select and copy the CSS code."
              )
            }
          }
        }

        function showCopyFeedback() {
          const button = document.getElementById("copy-button")
          if (button) {
            const originalText = button.textContent
            button.textContent = "Copied!"
            button.style.background = "var(--color-primary)"
            setTimeout(() => {
              button.textContent = originalText
              button.style.background = "var(--color-accent)"
            }, 1500)
          }
        }

        // Initialize everything
        updateColors()
        updateColorPreviews()
        updateCSSOutput()
        updateGamutWarnings()
      })
    </script>
  </body>
</html>
