---
import { getCollection } from "astro:content"
import BaseLayout from "../../layouts/BaseLayout.astro"
import Hero from "../../components/Hero.astro"

const allPosts = await getCollection("blog")

const frontmatter = {
  title: "Blog",
  description: "Blog posts about web development, photography, and research",
}

// Options for date formatting
const dateOptions: Intl.DateTimeFormatOptions = {
  year: "numeric",
  month: "long",
  day: "numeric",
}
---

<BaseLayout frontmatter={frontmatter}>
  <Hero>
    <h1>Blog Posts</h1>
    <p>Only a few posts for now, but more content is on the way!</p>
  </Hero>

  <article>
    <ul>
      {
        allPosts.map((post, index) => {
          const { title, description, pubDate, lastUpdatedDate, tags } =
            post.data
          const postUrl = `/blog/${post.slug}`

          return (
            <>
              <li>
                <header>
                  <h2>
                    <a href={postUrl}>{title}</a>
                  </h2>
                  {lastUpdatedDate &&
                  lastUpdatedDate.getTime() !== pubDate?.getTime() ? (
                    <time datetime={lastUpdatedDate.toISOString()}>
                      Updated on{" "}
                      {lastUpdatedDate.toLocaleDateString(
                        undefined,
                        dateOptions
                      )}
                    </time>
                  ) : (
                    pubDate && (
                      <time datetime={pubDate.toISOString()}>
                        Published on{" "}
                        {pubDate.toLocaleDateString(undefined, dateOptions)}
                      </time>
                    )
                  )}
                </header>
                {description && <p>{description}</p>}
                {tags && tags.length > 0 && (
                  <footer>
                    <nav>
                      <ul>
                        {tags.map((tag: string) => (
                          <li>
                            <a href={`/tags/${tag}`}>#{tag}</a>
                          </li>
                        ))}
                      </ul>
                    </nav>
                  </footer>
                )}
              </li>
            </>
          )
        })
      }
    </ul>
  </article>
</BaseLayout>
