---
import { getCollection } from "astro:content"
import BaseLayout from "../../layouts/BaseLayout.astro"
import Hero from "../../components/Hero.astro"
import BlogPostListItem from "../../components/BlogPostListItem.astro"
import { getReadingTime } from "../../utils/readingTime"
import { fontPreloadDefaults } from "../../config/fontPreload"

const allPosts = (
  await getCollection("blog", ({ data }) => data.draft !== true)
).sort((a, b) => {
  const dateA = a.data.pubDate?.getTime() ?? 0
  const dateB = b.data.pubDate?.getTime() ?? 0
  return dateB - dateA // Most recent first
})

// Pre-compute reading times for all posts
const postsWithReadingTime = allPosts.map((post) => ({
  post,
  readingTime: getReadingTime(post.body),
}))

const frontmatter = {
  title: "Blog",
  description: "Blog posts about web development, photography, and research",
}
---

<BaseLayout
  frontmatter={frontmatter}
  fontPreload={fontPreloadDefaults.blogList}
>
  <Hero>
    <h1>Blog Posts</h1>
    <p>Only a few posts for now, but more content is on the way!</p>
  </Hero>

  <ol>
    {
      postsWithReadingTime.map(({ post, readingTime }) => (
        <BlogPostListItem post={post} readingTime={readingTime} />
      ))
    }
  </ol>

  <nav>
    <ul>
      <li>
        <a href="/blog/tags">Browse blog tags</a>
      </li>
    </ul>
  </nav>
</BaseLayout>
